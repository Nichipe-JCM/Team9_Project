#include "GameManager.h"
#include "StatusManager.h"
#include "AchievementManager.h"
#include "Utils.h"
#include <iostream>
#include <Windows.h>

void DrawLogo() {
    // 1. 출력할 데이터를 배열(vector)에 저장합니다.
    // 이렇게 데이터와 로직을 분리하는 것이 유지보수에 유리합니다.
    const vector<string> logoData = {
        "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",
        "@@@@@@########@@@@#######@@@@@@@@####@@@@@@@######@@@@@##########@@@@####@@@@@@@",
        "@@@@@####@@@###@@@###@@@@###@@@@##@@##@@@@@@###@@@###@@@@@@###@@@@@@##@@##@@@@@@",
        "@@@@@###@@@@@@@@@@###@@@@###@@@###@@###@@@@@###@@@###@@@@@@###@@@@@###@@###@@@@@",
        "@@@@@@@######@@@@@###@@@@###@@@##@@@@##@@@@@#########@@@@@@###@@@@@##@@@@##@@@@@",
        "@@@@@##@@@@@@##@@@#########@@@##########@@@@#######@@@@@@@@###@@@@##########@@@@",
        "@@@@@###@@@@###@@@###@@@@@@@@@###@@@@###@@@@###@@@###@@@@@@###@@@@###@@@@###@@@@",
        "@@@@@@########@@@@###@@@@@@@@###@@@@@@###@@@###@@@###@@@@@@###@@@###@@@@@@###@@@",
        "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@@@@######################################@@@@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@@#######@@@@@####@@###########@@##########@@@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@######@@@@@@@@@##@@###########@@##########@@@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@#####@@@#####@@##@@##@@###@@##@@@@@@@######@@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@@####@@##########@@##@@###@@##@@###@@@#####@@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@@####@@@#####@@##@@##@@###@@##@@####@@######@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@@@####@@@@@@@@@##@@##@@@##@@##@@####@@######@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@@@######@@@@@####@@###@@@@@@##@@@@@@#######@@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@@@@######################################@@@@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",
        "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    };

    // 2. 각 줄(Line)을 순서대로 읽습니다.
    for (const string& line : logoData) {
        char lastChar = '\0'; // 바로 이전에 출력한 문자를 기억하는 변수

        // 3. 줄 안의 각 문자(Char)를 읽습니다.
        for (char c : line) {
            // 효율성: 현재 문자가 이전 문자와 다를 때만 색상을 변경합니다.
            // 계속 같은 색인데 색상 코드를 중복 출력하는 것은 비효율적이니까요.
            if (c != lastChar) {
                if (c == '@') {
                    cout << Color::BG_BRIGHT_WHITE << Color::BRIGHT_WHITE;
                }
                else if (c == '#') {
                    cout << Color::BG_RED << Color::RED;
                }
            }

            cout << c;    // 문자 출력
            lastChar = c; // 현재 문자를 '이전 문자'로 업데이트
        }
        // 줄이 바뀔 때는 색상을 초기화하고 줄바꿈을 합니다.
        cout << Color::RESET << endl;
    }
}

int main() {
    DrawLogo();
    Sleep(50000);
	SetConsoleOutputCP(65001);
	StatusManager* SM = new StatusManager();
	AchievementManager* AM = new AchievementManager();
	while (true) {
		GameManager GM(SM,AM);
		GM.Opening();
		GM.RunGame();
		int choice = 0;
		while (true) {
			cout << "게임을 다시 시작하시겠습니까?" << endl;
			cout << "1. 예" << endl;
			cout << "2. 아니오(프로그램 종료)" << endl;
			choice = Utils::GetSafeInput();
			if (choice == 1 || choice == 2) {
				break;
			}
			else cout << "잘못된 입력입니다." << endl;
		}
		if (choice == 1) {
			cout << "게임을 재시작합니다" << endl;
			continue;
		}
		else {
			cout << "게임을 종료합니다." << endl;
			return 0;
		}
	}
	delete SM;
	delete AM;
	return 0;
}